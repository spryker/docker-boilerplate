{% set ssl = project['docker']['ssl']['enabled'] | default(false) %}
{% set port = (domain | split(':'))[1] | default(ssl ? 443 :80) %}
{% set host = domain | split(':') | first %}
{% set rpcServer = "rpc_server_" ~ ( domainData['store'] | lower ) %}
server {
{% block server %}
{% block host %}
  server_name {{ host }};
  listen {{ port }} {{ ssl ? 'ssl http2' }};
{% if ssl %}
  include /etc/nginx/vhost.d/ssl.default.conf;
{% endif %}
{% endblock host %}
  access_log /var/log/nginx/access.log vhost;

  location / {
{% block location %}
    include fastcgi.conf;
    fastcgi_pass {{ upstream }};

{% include "nginx/default.location.conf.twig" with _context %}

{% include "nginx/store.params.conf.twig" with _context %}

    fastcgi_param SPRYKER_ZED_HOST {{ rpcServer }};
    fastcgi_param SPRYKER_ZED_PORT 80;
    fastcgi_param SPRYKER_SSL_ENABLE {{ ssl ? 1 : 0 }};
{% endblock location %}
  }
{% endblock server %}
}
