version: "3.7"

{% include "docker-compose/application-volumes.yml.twig" with _context %}

{#todo: cli BLACKFIRE_APM_ENABLED: ${BLACKFIRE_APM_ENABLED}#}
{#todo: gateway BLACKFIRE_APM_ENABLED: ${BLACKFIRE_APM_ENABLED}#}
{#todo: front BLACKFIRE_APM_ENABLED: ${BLACKFIRE_APM_ENABLED}#}

services:
{% include "docker-compose/gateway-compose.yml.twig" with _context %}

{% include "docker-compose/shared-services-compose.yml.twig" with _context %}

{% for projectName, projectData in projectsData %}
{% include "docker-compose/project-compose.yml.twig" with {
  'projectName': projectName,
  'projectData': projectData,
  'sharedServices': sharedServices,
  'internal_project_name': internal_project_name,
} %}
{% endfor %}

volumes:
{% include "docker-compose/shared-services-volumes-compose.yml.twig" with _context %}
{% include "docker-compose/project-volumes-compose.yml.twig" with {
  'projectsData': projectsData,
  'sharedServices': sharedServices,
  'internal_project_name': internal_project_name,
} %}

{% include "docker-compose/x-mutagen.yml.twig" with {
  mutagenData: mutagenData
} %}

{% include "docker-compose/components/network.yml.twig" with _context %}
